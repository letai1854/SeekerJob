@using SeekerJob.Controllers
@using SeekerJob.Models
@{
    var tablebanner = ViewData["tablebanners"] as List<tablebanner>;
    var tablebannerpart = ViewData["tablebannerparts"] as List<tablebannerpart>;
}

<div class="col-lg-4 col-md-12 rightSidebar">
    <div class="side-bar" style="background-color: rgb(35,168,234);">
        <div class="sidebar-elements search-bx">
            <form>
                @foreach (var item in tablebanner)
                {
                    if (item.meta == EnumType.Type.Diadiem.ToString())
                    {

                        <div class="form-group mb-4">
                            @*địa điểm*@
                            <h4 class="section-head-small mb-4">@item.name</h4>
                            <select class="wt-search-bar-select " data-live-search="true" id="j-All_Category" data-bv-field="size" data-size="10">
                                <option disabled selected value="">Chọn địa điểm</option>
                                <option value="An Giang">An Giang</option>
                                <option value="Bà Rịa - Vũng Tàu">Bà Rịa - Vũng Tàu</option>
                                <option value="Bạc Liêu">Bạc Liêu</option>
                                <option value="Bắc Giang">Bắc Giang</option>
                                <option value="Bắc Kạn">Bắc Kạn</option>
                                <option value="Bắc Ninh">Bắc Ninh</option>
                                <option value="Bến Tre">Bến Tre</option>
                                <option value="Bình Dương">Bình Dương</option>
                                <option value="Bình Định">Bình Định</option>
                                <option value="Bình Phước">Bình Phước</option>
                                <option value="Bình Thuận">Bình Thuận</option>
                                <option value="Cà Mau">Cà Mau</option>
                                <option value="Cao Bằng">Cao Bằng</option>
                                <option value="Cần Thơ">Cần Thơ</option>
                                <option value="Đà Nẵng">Đà Nẵng</option>
                                <option value="Đắk Lắk">Đắk Lắk</option>
                                <option value="Đắk Nông">Đắk Nông</option>
                                <option value="Điện Biên">Điện Biên</option>
                                <option value="Đồng Nai">Đồng Nai</option>
                                <option value="Đồng Tháp">Đồng Tháp</option>
                                <option value="Gia Lai">Gia Lai</option>
                                <option value="Hà Giang">Hà Giang</option>
                                <option value="Hà Nam">Hà Nam</option>
                                <option value="Hà Nội">Hà Nội</option>
                                <option value="Hà Tĩnh">Hà Tĩnh</option>
                                <option value="Hải Dương">Hải Dương</option>
                                <option value="Hải Phòng">Hải Phòng</option>
                                <option value="Hậu Giang">Hậu Giang</option>
                                <option value="Hòa Bình">Hòa Bình</option>
                                <option value="Hưng Yên">Hưng Yên</option>
                                <option value="Khánh Hòa">Khánh Hòa</option>
                                <option value="Kiên Giang">Kiên Giang</option>
                                <option value="Kon Tum">Kon Tum</option>
                                <option value="Lai Châu">Lai Châu</option>
                                <option value="Lâm Đồng">Lâm Đồng</option>
                                <option value="Lạng Sơn">Lạng Sơn</option>
                                <option value="Lào Cai">Lào Cai</option>
                                <option value="Long An">Long An</option>
                                <option value="Nam Định">Nam Định</option>
                                <option value="Nghệ An">Nghệ An</option>
                                <option value="Ninh Bình">Ninh Bình</option>
                                <option value="Ninh Thuận">Ninh Thuận</option>
                                <option value="Phú Thọ">Phú Thọ</option>
                                <option value="Phú Yên">Phú Yên</option>
                                <option value="Quảng Bình">Quảng Bình</option>
                                <option value="Quảng Nam">Quảng Nam</option>
                                <option value="Quảng Ngãi">Quảng Ngãi</option>
                                <option value="Quảng Ninh">Quảng Ninh</option>
                                <option value="Quảng Trị">Quảng Trị</option>
                                <option value="Sóc Trăng">Sóc Trăng</option>
                                <option value="Sơn La">Sơn La</option>
                                <option value="Tây Ninh">Tây Ninh</option>
                                <option value="Thái Bình">Thái Bình</option>
                                <option value="Thái Nguyên">Thái Nguyên</option>
                                <option value="Thanh Hóa">Thanh Hóa</option>
                                <option value="Thừa Thiên Huế">Thừa Thiên Huế</option>
                                <option value="Tiền Giang">Tiền Giang</option>
                                <option value="TP. Hồ Chí Minh">TP. Hồ Chí Minh</option>
                                <option value="Trà Vinh">Trà Vinh</option>
                                <option value="Tuyên Quang">Tuyên Quang</option>
                                <option value="Vĩnh Long">Vĩnh Long</option>
                                <option value="Vĩnh Phúc">Vĩnh Phúc</option>
                                <option value="Yên Bái">Yên Bái</option>
                            </select>
                        </div>
                    }
                    else
                    {
                        <div class="twm-sidebar-ele-filter">
                            <h4 class="section-head-small mb-4">@item.name</h4>
                            <ul>
                                @foreach (var itemElement in tablebannerpart)
                                {
                                    if (item.id == itemElement.idtable && item.meta == EnumType.Type.Loaicongviec.ToString() && itemElement.content != "Tạm thời" && itemElement.content != "Tình nguyện")
                                    {
                                        <li>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="exampleCheck1_@itemElement.meta">
                                                <label class="form-check-label" for="exampleCheck1_@itemElement.meta" style="color:black">@itemElement.content</label>
                                            </div>
                                        </li>
                                    }
                                    if (item.id == itemElement.idtable && item.meta == EnumType.Type.Ngaydang.ToString())
                                    {
                                        <li>
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="radioGroup" id="exampleradio1_@itemElement.meta">
                                                <label class="form-check-label" for="exampleradio1_@itemElement.meta" style="color:black">@itemElement.content</label>
                                            </div>
                                        </li>
                                    }
                                    if (item.id == itemElement.idtable && item.meta == EnumType.Type.Mucluong.ToString())
                                    {
                                        <li>
                                            <div class="form-group">
                                                <label for="@itemElement.meta" style="color:black">@itemElement.content</label>
                                                <input type="number" class="form-control" id="@itemElement.meta" name="@itemElement.meta"
                                                       placeholder="Nhập @itemElement.content $" min="0" step="500">
                                                <div class="salary-error" style="color:red">Lương khởi điểm không được lớn hơn lương kết thúc</div>

                                            </div>
                                        </li>
                                    }
                                }
                            </ul>
                        </div>
                    }
                }
                <div class="form-group">
                    <button type="button" class="site-button" style="background-color: rgb(222,152,23);">Tìm kiếm</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#Luong-khoi-diem, #Luong-ket-thuc').on('input', function() {
        var salaryFrom = parseFloat($('#Luong-khoi-diem').val()) || 0;
        var salaryTo = parseFloat($('#Luong-ket-thuc').val()) || 0;
        
        // Ẩn thông báo lỗi khi người dùng thay đổi giá trị
            $('.salary-error').hide();
        });
        $('.site-button').click(function () {
            // Lấy giá trị địa điểm
            var salaryFrom = parseFloat($('#Luong-khoi-diem').val()) || 0;
        var salaryTo = parseFloat($('#Luong-ket-thuc').val()) || 0;

        // Kiểm tra lương
        if (salaryFrom > salaryTo) {
            $('.salary-error').show();
                return false; // Ngăn không cho thực hiện tìm kiếm
            }
            var address = $('#j-All_Category').val();

            // Lấy danh sách loại công việc được chọn
            var jobCategories = [];
            $('input[type="checkbox"]:checked').each(function () {
                var label = $(this).siblings('label').text();
                jobCategories.push(label);
            });

            // Lấy giá trị thời gian đăng
            var postDayType = '';
            // Kiểm tra từng radio button theo ID
            if ($('#exampleradio1_Trong-gio-qua').is(':checked')) {
                postDayType = "1hour";
            } else if ($('#exampleradio1_Trong-24-gio-qua').is(':checked')) {
                postDayType = "24hours";
            } else if ($('#exampleradio1_Trong-7-ngay-qua').is(':checked')) {
                postDayType = "7days";
            } else if ($('#exampleradio1_Trong-14-ngay-qua').is(':checked')) {
                postDayType = "14days";
            } else if ($('#exampleradio1_Trong-30-ngay-qua').is(':checked')) {
                postDayType = "30days";
            } else if ($('#exampleradio1_Tat-ca').is(':checked')) {
                postDayType = "all";
            }

            // Lấy giá trị lương
            var salaryFrom = $('#Luong-khoi-diem').val();
            var salaryTo = $('#Luong-ket-thuc').val();

            // Chuyển đổi sang số nếu có giá trị
            salaryFrom = salaryFrom ? parseFloat(salaryFrom) : null;
            salaryTo = salaryTo ? parseFloat(salaryTo) : null;

            // Gửi Ajax request
            $.ajax({
                url: '/ListJob/SearchJobs',
                type: 'POST',
                data: {
                    address: address,
                    jobCategories: jobCategories,
                    postDayType: postDayType,
                    salaryFrom: salaryFrom,
                    salaryTo: salaryTo
                },
                success: function (response) {
                    // Cập nhật nội dung bảng
                    var tableContainer = $('#jobs_bookmark_table2').closest('.twm-jobs-list-wrap');
                    tableContainer.html(response);

                    // Khởi tạo lại DataTable
                    //initializeDataTable();
                },
                error: function (xhr, status, error) {
                    console.error('Lỗi khi tìm kiếm:', error);
                    console.log('Request data:', {
                        address: address,
                        jobCategories: jobCategories,
                        postDayType: postDayType,
                        salaryFrom: salaryFrom,
                        salaryTo: salaryTo
                    });
                }
            });
        });
    });

    function initializeDataTable() {
        // Hủy DataTable nếu đã tồn tại
        if ($.fn.DataTable.isDataTable('#jobs_bookmark_table2')) {
            $('#jobs_bookmark_table2').DataTable().destroy();
        }

        // Khởi tạo lại DataTable
        $('#jobs_bookmark_table2').DataTable({
            "paging": true,
            "pageLength": 10,
            "lengthChange": false,
            "searching": true,
            "info": false,
            "autoWidth": false,
            "language": {
                "paginate": {
                    "previous": "Trước",
                    "next": "Sau"
                }
            }
        });
    }
</script>